<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>{{ month }} の全日シフト</title>
  <style>
    body {
      font-family: sans-serif;
      font-size: 12px;
      margin: 0;
      padding: 0;
    }

    h2 {
      padding: 16px;
      margin: 0;
    }

    .day-block {
      margin-bottom: 24px;
      border-top: 1px solid #ccc;
      padding: 8px 16px;
    }

    .day-title {
      font-weight: bold;
      margin-bottom: 4px;
    }

    .staff-row {
      display: flex;
      align-items: center;
      margin-bottom: 2px;
    }

    .staff-name {
      width: 120px;
      font-weight: bold;
    }

    .bar-area {
      position: relative;
      width: calc(34 * 15px);
      height: 20px;
      background: #f0f0f0;
    }

    .bar {
      position: absolute;
      height: 100%;
      border-radius: 2px;
    }

    .shift { background-color: #4a90e2; }
    .break { background-color: #f8e71c; }
    .desk  { background-color: #7ed321; }
    .other { background-color: #f5a623; }
  </style>
</head>
<body>
  <h2>{{ month }} の全日シフト（表示専用）</h2>

  {% for day in all_data %}
    <div class="day-block">
      <div class="day-title">{{ day.date }}</div>

      {% for name, info in day.schedule.items() %}
        <div class="staff-row">
          <div class="staff-name">{{ name }}</div>
          <div class="bar-area">
            {% for s in info.shift %}
              {% set start = s[0] %}
              {% set end = s[1] %}
              {% set left = ((start[:2]|int - 7) * 2 + (1 if start[3:] == '30' else 0)) * 15 %}
              {% set width = (((end[:2]|int * 60 + end[3:]|int) - (start[:2]|int * 60 + start[3:]|int)) // 30) * 15 %}
              <div class="bar shift" style="left: {{ left }}px; width: {{ width }}px;"></div>
            {% endfor %}
            {% for e in info.exclude %}
              {% set start = e.start %}
              {% set end = e.end %}
              {% set category = e.category %}
              {% set left = ((start[:2]|int - 7) * 2 + (1 if start[3:] == '30' else 0)) * 15 %}
              {% set width = (((end[:2]|int * 60 + end[3:]|int) - (start[:2]|int * 60 + start[3:]|int)) // 30) * 15 %}
              <div class="bar {{ category }}" style="left: {{ left }}px; width: {{ width }}px;"></div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endfor %}
</body>
</html>
